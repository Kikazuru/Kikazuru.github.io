import{V as _,a as X,b as O,d as j,c as Q,e as R}from"./VDataTableServer-a735c4fc.js";import{b as P}from"./index-b4878894.js";import{b as x,a as A,V as Y}from"./VRow-582c34c5.js";import{V as q,a as D}from"./VTextField-744f38d5.js";import{V as S,a as N,b as B,c as h,d as z}from"./VCard-99429928.js";import{V as y,k as M}from"./VBtn-1189b8c8.js";import{d as F,g as c,x as $,o as g,h as b,w as a,a as e,i as u,b as k,G as Z,P as T,O as E,f as ee,c as ae,W,F as le}from"./index-4ae7351a.js";import{p as H,t as te,v as se,w as oe,x as ue}from"./VOverlay-5a8b697f.js";import"./VAvatar-701b24ac.js";import"./tag-21e3285f.js";async function ne(){return await P.get("/users")}async function re(v){return await P.post("/users",v)}async function de(v){return await P.delete(`/users/${v}`)}async function ie(v,w){return await P.put(`/users/${v}`,w)}const me=k("div",{class:"mb-3"},"Login Credentials",-1),pe=k("div",{class:"mb-3"},"Personal Info",-1),fe=F({__name:"AddUser",props:{modelValue:{type:Boolean}},emits:["update:modelValue","update:addUser"],setup(v,{emit:w}){const i=c(),n=c({password:"randompass",name:"",email:"",role:"issuer"}),U=v,p=w,s=$({get(){return U.modelValue},set(r){p("update:modelValue",r)}});async function f(){const{valid:r}=await i.value.validate();if(r){const t=j(n.value);re(t).then(l=>{l.data.success&&V().then(()=>{i.value.reset()})})}}async function V(){s.value=!1,p("update:addUser")}return(r,t)=>(g(),b(O,{modelValue:s.value,"onUpdate:modelValue":t[4]||(t[4]=l=>s.value=l)},{default:a(()=>[e(A,null,{default:a(()=>[e(_),e(x,{cols:"12",xxl:"4",xl:"4",lg:"4",md:"4",sm:"7"},{default:a(()=>[e(q,{ref_key:"myForm",ref:i},{default:a(()=>[e(S,{"max-height":"90vh",class:"overflow-auto"},{default:a(()=>[e(N,null,{default:a(()=>[e(B,null,{default:a(()=>[u(" Add User ")]),_:1})]),_:1}),e(h,null,{default:a(()=>[me,e(D,{modelValue:n.value.email,"onUpdate:modelValue":t[0]||(t[0]=l=>n.value.email=l),type:"email",label:"Email"},null,8,["modelValue"])]),_:1}),e(h,{class:"pt-0"},{default:a(()=>[pe,e(D,{modelValue:n.value.name,"onUpdate:modelValue":t[1]||(t[1]=l=>n.value.name=l),label:"Name"},null,8,["modelValue"]),e(X,{modelValue:n.value.role,"onUpdate:modelValue":t[2]||(t[2]=l=>n.value.role=l),items:["issuer","admin"],label:"Role"},null,8,["modelValue"])]),_:1}),e(z,null,{default:a(()=>[e(_),e(y,{onClick:f,class:"bg-primary"},{default:a(()=>[u(" ADD ")]),_:1}),e(y,{onClick:t[3]||(t[3]=l=>s.value=!1),variant:"text",color:"primary"},{default:a(()=>[u(" CANCEL ")]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1}),e(_)]),_:1})]),_:1},8,["modelValue"]))}}),ce=k("div",{class:"mb-3"},"Credentials",-1),ve=k("div",{class:"mb-3"},"Personal Info",-1),Ve=F({__name:"UpdateUser",props:{user:{},show:{type:Boolean}},emits:["update:user","update:show","userUpdated"],setup(v,{emit:w}){const i=c(),n=w,U=v,p=$(()=>U.user);Z(p,t=>{const l={email:t.email,name:t.name,password:"",role:t.role};s.value=l});const s=c({email:"",name:"",password:"",role:"admin"}),f=$({get(){return U.show},set(t){n("update:show",t)}}),V=H();async function r(){const{valid:t}=await i.value.validate();if(t){const l=j(s.value);ie(U.user.id,l).then(d=>{if(!d.data.success)throw Error;n("userUpdated",l),i.value.reset(),V.showSnackbar("User data has been updated!","success")}).catch(()=>{V.showSnackbar("Update user failed!","error")}).finally(()=>{f.value=!1})}}return(t,l)=>(g(),b(O,{modelValue:f.value,"onUpdate:modelValue":l[5]||(l[5]=d=>f.value=d)},{default:a(()=>[e(A,null,{default:a(()=>[e(_),e(x,{cols:"12",xxl:"4",xl:"4",lg:"4",md:"4",sm:"7"},{default:a(()=>[e(q,{ref_key:"myForm",ref:i},{default:a(()=>[e(S,{"max-height":"90vh",class:"overflow-auto"},{default:a(()=>[e(N,null,{default:a(()=>[e(B,null,{default:a(()=>[u(" Update User ")]),_:1})]),_:1}),e(h,null,{default:a(()=>[ce,e(D,{modelValue:s.value.email,"onUpdate:modelValue":l[0]||(l[0]=d=>s.value.email=d),type:"email",label:"Email"},null,8,["modelValue"]),e(D,{modelValue:s.value.password,"onUpdate:modelValue":l[1]||(l[1]=d=>s.value.password=d),type:"password",label:"Password"},null,8,["modelValue"])]),_:1}),e(h,{class:"pt-0"},{default:a(()=>[ve,e(D,{modelValue:s.value.name,"onUpdate:modelValue":l[2]||(l[2]=d=>s.value.name=d),label:"Name"},null,8,["modelValue"]),e(X,{disabled:"",modelValue:s.value.role,"onUpdate:modelValue":l[3]||(l[3]=d=>s.value.role=d),items:["issuer","admin"],label:"Role"},null,8,["modelValue"])]),_:1}),e(z,null,{default:a(()=>[e(_),e(y,{onClick:r,class:"bg-primary"},{default:a(()=>[u(" UPDATE ")]),_:1}),e(y,{onClick:l[4]||(l[4]=d=>f.value=!1),variant:"text",color:"primary"},{default:a(()=>[u(" CANCEL ")]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1}),e(_)]),_:1})]),_:1},8,["modelValue"]))}}),Ue={class:"d-flex justify-end mb-2"},_e=F({__name:"DeleteUser",props:{modelValue:{},show:{type:Boolean}},emits:["update:modelValue","update:show","update:deleteUser"],setup(v,{emit:w}){const i=v,n=w,U=$({get(){return i.modelValue},set(r){n("update:modelValue",r)}}),p=$({get(){return i.show},set(r){n("update:show",r)}});function s(){p.value=!1}const f=H();function V(r){de(r.id).then(t=>{if(!t.data.success)throw Error;f.showSnackbar("User data has been deleted!","success"),n("update:deleteUser"),p.value=!1}).catch(()=>{f.showSnackbar("Delete user failed!","error")})}return(r,t)=>(g(),b(O,{width:"auto",modelValue:p.value,"onUpdate:modelValue":t[1]||(t[1]=l=>p.value=l)},{default:a(()=>[e(S,{class:"text-center pa-4",rounded:"lg"},{default:a(()=>[k("div",Ue,[e(M,{onClick:s,size:"small"},{default:a(()=>[u(T(E(te)),1)]),_:1})]),e(N,null,{default:a(()=>[e(B,null,{default:a(()=>[u(" Are you sure want to delete the user? ")]),_:1})]),_:1}),e(h,null,{default:a(()=>[u(" This action cannot be undo ")]),_:1}),e(z,null,{default:a(()=>[e(_),e(y,{onClick:t[0]||(t[0]=l=>V(U.value)),variant:"flat",color:"primary"},{default:a(()=>[u(" DELETE ")]),_:1}),e(y,{onClick:s,color:"primary"},{default:a(()=>[u(" CANCEL ")]),_:1}),e(_)]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),we=k("div",{class:"text-h5 font-weight-bold"},"User Management",-1),ge={class:"d-flex justify-center flex-wrap"},Te=F({__name:"UserManagement",setup(v){const i=ee().permissions,n=c(10),U=c(100),p=c(!0),s=c([]),f=[{title:"EMAIL",key:"email"},{title:"GROUP NAME",key:"group-name"},{title:"STATUS",key:"state",sortable:!1,align:"center"}];i["user.update"]&&f.push({title:"UPDATE",key:"update",sortable:!1,align:"center"}),i["user.delete"]&&f.push({title:"DELETE",key:"delete",sortable:!1,align:"center"});function V(){p.value=!0,ne().then(C=>{s.value=C.data.result.users}).finally(()=>{setTimeout(()=>{p.value=!1},2e3)})}const r=c(!1);function t(){V()}const l=c(),d=c(!1);function G(C){l.value=C,d.value=!0}const L=c(),I=c(!1);function J(C){L.value=j(C),I.value=!0}return(C,m)=>(g(),ae(le,null,[e(Y,{fluid:""},{default:a(()=>[e(A,null,{default:a(()=>[e(x,null,{default:a(()=>[we]),_:1})]),_:1}),e(A,null,{default:a(()=>[e(x,null,{default:a(()=>[e(S,null,{default:a(()=>[e(N,null,{default:a(()=>[e(B,null,{default:a(()=>[u(" List Of Users ")]),_:1})]),_:1}),e(h,{class:"mt-2"},{default:a(()=>[e(A,null,{default:a(()=>[e(x,null,{default:a(()=>[e(y,{variant:"outlined","prepend-icon":E(se)},{default:a(()=>[u(" EXPORT ")]),_:1},8,["prepend-icon"])]),_:1}),e(_),e(x,{cols:"12",xxl:"4",xl:"4",lg:"4",md:"4"},{default:a(()=>[k("div",ge,[e(D,{placeholder:"Search user or group name","hide-details":"",variant:"outlined",density:"compact"}),E(i)["user.create"]?(g(),b(y,{key:0,onClick:m[0]||(m[0]=o=>r.value=!0),variant:"tonal",class:"bg-primary ms-2"},{default:a(()=>[u(" ADD USER ")]),_:1})):W("",!0)])]),_:1})]),_:1})]),_:1}),e(h,null,{default:a(()=>[e(Q,{"return-object":"","show-select":"",color:"secondary","items-per-page":n.value,"onUpdate:itemsPerPage":m[1]||(m[1]=o=>n.value=o),headers:f,"items-length":U.value,items:s.value,loading:p.value,"item-value":"name","onUpdate:options":V},{"item.group-name":a(()=>[u(T("-"))]),"item.state":a(({item:o})=>[o.state=="active"?(g(),b(R,{key:0,color:"success",label:""},{default:a(()=>[u("Active")]),_:1})):o.state=="pending"?(g(),b(R,{key:1,color:"warning",label:""},{default:a(()=>[u("Pending")]),_:1})):o.state=="deleted"?(g(),b(R,{key:2,color:"error",label:""},{default:a(()=>[u("Deleted")]),_:1})):W("",!0)]),"item.update":a(({item:o})=>[e(M,{onClick:K=>J(o),size:"large",color:"secondary"},{default:a(()=>[u(T(E(oe)),1)]),_:2},1032,["onClick"])]),"item.delete":a(({item:o})=>[e(M,{onClick:K=>G(o),size:"large",color:"secondary"},{default:a(()=>[u(T(E(ue)),1)]),_:2},1032,["onClick"])]),_:2},1032,["items-per-page","items-length","items","loading"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(fe,{"onUpdate:addUser":t,modelValue:r.value,"onUpdate:modelValue":m[2]||(m[2]=o=>r.value=o)},null,8,["modelValue"]),e(_e,{show:d.value,"onUpdate:show":m[3]||(m[3]=o=>d.value=o),modelValue:l.value,"onUpdate:modelValue":m[4]||(m[4]=o=>l.value=o),"onUpdate:deleteUser":V},null,8,["show","modelValue"]),e(Ve,{onUserUpdated:V,user:L.value,"onUpdate:user":m[5]||(m[5]=o=>L.value=o),show:I.value,"onUpdate:show":m[6]||(m[6]=o=>I.value=o)},null,8,["user","show"])],64))}});export{Te as default};
