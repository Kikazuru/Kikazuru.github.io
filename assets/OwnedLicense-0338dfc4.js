import{q as R,r as M}from"./lazy-eda09f13.js";import{_ as P}from"./MessageDialog.vue_vue_type_script_setup_true_lang-db1065c2.js";import{d as S,r as n,z as N,R as Y,o as V,h as U,g as e,f as t,j as l,a as D,m as k,c as B,S as v,a7 as $}from"./index-69d1502a.js";import{b,a as y,d as L,V as x,i as E}from"./index-6405a72a.js";import{V as F}from"./VAutocomplete-e056e3cf.js";import{V as w,p as H}from"./VBtn-421a5577.js";import{V as O}from"./VDataTableServer-921b4e3b.js";import{V as C}from"./VChip-b541bb3f.js";import{a as j}from"./api-77cd4ed9.js";import{l as z}from"./issuer-07d3c33d.js";import{b as I,a as A,V as X}from"./VRow-1f387fa0.js";import"./tag-446592ee.js";import"./filter-bfc06a5f.js";import"./VTextField-f7af6f26.js";import"./VList-0497e142.js";const q={class:"d-flex"},G={key:1},J=S({__name:"LockedLicenseTable",props:{getLockedLogs:{type:Function},issuerId:{},issuers:{}},emits:["update:issuerId"],setup(m,{emit:i}){const u=n(1),r=n(10),g=n(100),f=n(!0),_=[{title:"IDENTIFIER",key:"lockIdentifier"},{title:"STATUS",key:"success"},{title:"CREATED AT",key:"createdAt"}],o=m,c=i,p=N({get(){return o.issuerId},set(d){c("update:issuerId",d)}}),h=n([]);function T(){f.value=!0;const d={limit:r.value,page:u.value};p.value&&(d.issuerId=p.value),o.getLockedLogs(d).then(a=>{const s=a.data.result;h.value=s.logs||[],g.value=s.recordsCount}).finally(()=>{setTimeout(()=>{f.value=!1},2e3)})}return Y(()=>{T()}),(d,a)=>(V(),U(x,null,{default:e(()=>[t(y,null,{default:e(()=>[t(b,null,{default:e(()=>[l("Locked License Log ")]),_:1})]),_:1}),t(L,{class:"mt-2"},{default:e(()=>[D("div",q,[t(F,{class:"w-25 flex-grow-0 me-2",label:"Issuer",density:"compact","hide-details":"",items:o.issuers,"item-title":"name","item-value":"id",modelValue:p.value,"onUpdate:modelValue":a[0]||(a[0]=s=>p.value=s),clearable:""},null,8,["items","modelValue"]),t(w,{variant:"outlined","prepend-icon":k(R)},{default:e(()=>[l(" EXPORT ")]),_:1},8,["prepend-icon"])])]),_:1}),t(L,null,{default:e(()=>[t(O,{"return-object":"",color:"secondary",page:u.value,"onUpdate:page":a[1]||(a[1]=s=>u.value=s),"items-per-page":r.value,"onUpdate:itemsPerPage":a[2]||(a[2]=s=>r.value=s),headers:_,"items-length":g.value,items:h.value,loading:f.value,"item-value":"name","onUpdate:options":T},{loading:e(()=>[l(" Loading locked license log... ")]),"item.success":e(({item:s})=>[s.success==!0?(V(),U(C,{key:0,label:"",color:"success"},{default:e(()=>[l(" Success ")]),_:1})):(V(),B("div",G,[t(C,{class:"me-2",label:"",color:"error"},{default:e(()=>[l(" Error ")]),_:1}),t(w,{icon:"",size:"small",variant:"text"},{default:e(()=>[t(H,null,{default:e(()=>[l(v(k(M)),1)]),_:1}),t(P,{title:"Error Message",message:s.errorMessage},null,8,["message"])]),_:2},1024)]))]),"item.createdAt":e(({item:s})=>[l(v(k($)(s.createdAt,"DD MMM YYYY HH:mm")),1)]),_:2},1032,["page","items-per-page","items-length","items","loading"])]),_:1})]),_:1}))}}),K={class:"d-flex"},Q={key:1},W=S({__name:"UsedLicenseTable",props:{getUsedLogs:{type:Function},issuerId:{},issuers:{}},emits:["update:issuerId"],setup(m,{emit:i}){const u=n(1),r=n(10),g=n(100),f=n(!0),_=[{title:"IDENTIFIER",key:"lockIdentifier"},{title:"STATUS",key:"success"},{title:"CREATED AT",key:"createdAt"},{title:"CARD NUMBER",key:"cardNumber"}],o=m,c=i,p=N({get(){return o.issuerId},set(d){c("update:issuerId",d)}}),h=n([]);function T(){f.value=!0;const d={limit:r.value,page:u.value};p.value&&(d.issuerId=p.value),o.getUsedLogs(d).then(a=>{const s=a.data.result;h.value=s.logs||[],g.value=s.recordsCount}).finally(()=>{setTimeout(()=>{f.value=!1},2e3)})}return Y(()=>{T()}),(d,a)=>(V(),U(x,null,{default:e(()=>[t(y,null,{default:e(()=>[t(b,null,{default:e(()=>[l("Used License Log ")]),_:1})]),_:1}),t(L,{class:"mt-2"},{default:e(()=>[D("div",K,[t(F,{class:"w-25 flex-grow-0 me-2",label:"Issuer",density:"compact","hide-details":"",items:o.issuers,"item-title":"name","item-value":"id",modelValue:p.value,"onUpdate:modelValue":a[0]||(a[0]=s=>p.value=s),clearable:""},null,8,["items","modelValue"]),t(w,{variant:"outlined","prepend-icon":k(R)},{default:e(()=>[l(" EXPORT ")]),_:1},8,["prepend-icon"])])]),_:1}),t(L,null,{default:e(()=>[t(O,{"return-object":"",color:"secondary",page:u.value,"onUpdate:page":a[1]||(a[1]=s=>u.value=s),"items-per-page":r.value,"onUpdate:itemsPerPage":a[2]||(a[2]=s=>r.value=s),headers:_,"items-length":g.value,items:h.value,loading:f.value,"item-value":"name","onUpdate:options":T},{loading:e(()=>[l(" Loading used license log... ")]),"item.success":e(({item:s})=>[s.success==!0?(V(),U(C,{key:0,label:"",color:"success"},{default:e(()=>[l(" Success ")]),_:1})):(V(),B("div",Q,[t(C,{class:"me-2",label:"",color:"error"},{default:e(()=>[l(" Error ")]),_:1}),t(w,{icon:"",size:"small",variant:"text"},{default:e(()=>[t(H,null,{default:e(()=>[l(v(k(M)),1)]),_:1}),t(P,{title:"Error Message",message:s.errorMessage},null,8,["message"])]),_:2},1024)]))]),"item.createdAt":e(({item:s})=>[l(v(k($)(s.createdAt,"DD MMM YYYY HH:mm")),1)]),_:2},1032,["page","items-per-page","items-length","items","loading"])]),_:1})]),_:1}))}});async function Z({limit:m=10,page:i=1,issuerId:u}){return await j.get("/licenses/lock",{params:{limit:m,page:i,issuerId:u}})}async function ee({limit:m=10,page:i=1,issuerId:u}){return await j.get("/licenses/consume",{params:{limit:m,page:i,issuerId:u}})}async function te(){return{data:{result:{reserved:1e5,remaining:9800,locked:190,used:10},success:!0}}}const se=D("div",{class:"text-h5 font-weight-bold"},"Owned License",-1),Le=S({__name:"OwnedLicense",setup(m){const i=n({reserved:0,remaining:0,locked:0,used:0});te().then(_=>{const o=_.data.result;i.value=o});const u=n(null),r=n([]),g=n(1);async function f(){z({page:g.value,limit:10}).then(_=>{const c=_.data.result.issuers;c&&(r.value.push(...c),g.value++)})}return f(),(_,o)=>(V(),U(X,{fluid:""},{default:e(()=>[t(A,null,{default:e(()=>[t(I,null,{default:e(()=>[se]),_:1})]),_:1}),t(A,null,{default:e(()=>[t(I,null,{default:e(()=>[t(x,null,{default:e(()=>[t(y,null,{default:e(()=>[t(b,null,{default:e(()=>[l(" Reserved License ")]),_:1}),t(E,null,{default:e(()=>[l("description")]),_:1})]),_:1}),t(L,{class:"text-h4 font-weight-bold"},{default:e(()=>[l(v(i.value.reserved.toLocaleString("id")),1)]),_:1})]),_:1})]),_:1}),t(I,null,{default:e(()=>[t(x,null,{default:e(()=>[t(y,null,{default:e(()=>[t(b,null,{default:e(()=>[l(" Remaining License ")]),_:1}),t(E,null,{default:e(()=>[l("description")]),_:1})]),_:1}),t(L,{class:"text-h4 font-weight-bold"},{default:e(()=>[l(v(i.value.remaining.toLocaleString("id")),1)]),_:1})]),_:1})]),_:1}),t(I,null,{default:e(()=>[t(x,null,{default:e(()=>[t(y,null,{default:e(()=>[t(b,null,{default:e(()=>[l(" Locked License ")]),_:1}),t(E,null,{default:e(()=>[l("description")]),_:1})]),_:1}),t(L,{class:"text-h4 font-weight-bold"},{default:e(()=>[l(v(i.value.locked.toLocaleString("id")),1)]),_:1})]),_:1})]),_:1}),t(I,null,{default:e(()=>[t(x,null,{default:e(()=>[t(y,null,{default:e(()=>[t(b,null,{default:e(()=>[l(" Used License ")]),_:1}),t(E,null,{default:e(()=>[l("description")]),_:1})]),_:1}),t(L,{class:"text-h4 font-weight-bold"},{default:e(()=>[l(v(i.value.used.toLocaleString("id")),1)]),_:1})]),_:1})]),_:1})]),_:1}),t(A,null,{default:e(()=>[t(I,{cols:"12",xxl:"6"},{default:e(()=>[t(J,{issuers:r.value,"issuer-id":u.value,"onUpdate:issuerId":o[0]||(o[0]=c=>u.value=c),"get-locked-logs":k(Z)},null,8,["issuers","issuer-id","get-locked-logs"])]),_:1}),t(I,{cols:"12",xxl:"6"},{default:e(()=>[t(W,{issuers:r.value,"issuer-id":u.value,"onUpdate:issuerId":o[1]||(o[1]=c=>u.value=c),"get-used-logs":k(ee)},null,8,["issuers","issuer-id","get-used-logs"])]),_:1})]),_:1})]),_:1}))}});export{Le as default};
