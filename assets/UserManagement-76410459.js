import{_ as M,a as j}from"./ViewUser.vue_vue_type_script_setup_true_lang-d4a58059.js";import{d as A}from"./common-5dc68c7b.js";import{a as w}from"./api-a2ad3bbc.js";import{e as N,n as D}from"./rules-28b1d808.js";import{V as c,d as E,a as F}from"./VDataTableServer-b0c4b5cf.js";import{b as C,a as y,V as q}from"./VRow-a32ba34a.js";import{d as S,V as T,a as B,b as L,c as x,e as k,f as P}from"./VTextField-bf30aba6.js";import{V as R}from"./VAutocomplete-be82bb74.js";import{V as g}from"./VBtn-18a3f883.js";import{d as I,r as _,o as $,h,g as a,f as e,j as v,m as V,a as U}from"./index-d82b7293.js";import{u as z}from"./snackbar-17fa77a2.js";import{l as G}from"./issuer-745d4891.js";import"./mdi-e82a7810.js";import"./user-841668b4.js";import"./index-babec776.js";import"./tag-19c9ac46.js";import"./VOverlay-d18fd668.js";async function H(){return await w.get("/users")}async function J(i){return await w.post("/users",i)}async function K(i,o){return await w.put(`/users/${i}`,o)}const O=U("div",{class:"mb-3"},"Login Credentials",-1),Q=U("div",{class:"mb-3"},"Personal Info",-1),W=I({__name:"AddUser",props:{issuers:{}},emits:["userAdded"],setup(i,{emit:o}){const d=_(),t=_({name:"",email:"",role:"issuer",issuerId:""}),n=i,s=o;async function m(b){const{valid:u}=await d.value.validate();if(u){const f=A(t.value);J(f).then(l=>{l.data.success&&(s("userAdded"),b.value=!1,d.value.reset())})}}return(b,u)=>($(),h(F,{activator:"parent"},{default:a(({isActive:f})=>[e(y,null,{default:a(()=>[e(c),e(C,{cols:"12",xxl:"4",xl:"4",lg:"4",md:"4",sm:"7"},{default:a(()=>[e(S,{ref_key:"myForm",ref:d},{default:a(()=>[e(T,{"max-height":"90vh",class:"overflow-auto"},{default:a(()=>[e(B,null,{default:a(()=>[e(L,null,{default:a(()=>[v(" Add User ")]),_:1})]),_:1}),e(x,null,{default:a(()=>[O,e(k,{rules:V(N),modelValue:t.value.email,"onUpdate:modelValue":u[0]||(u[0]=l=>t.value.email=l),type:"email",label:"Email"},null,8,["rules","modelValue"])]),_:1}),e(x,{class:"pt-0"},{default:a(()=>[Q,e(k,{class:"mb-3",rules:V(D),modelValue:t.value.name,"onUpdate:modelValue":u[1]||(u[1]=l=>t.value.name=l),label:"Name"},null,8,["rules","modelValue"]),e(R,{items:n.issuers,"item-title":"name","item-value":"id",class:"mb-3",modelValue:t.value.issuerId,"onUpdate:modelValue":u[2]||(u[2]=l=>t.value.issuerId=l),label:"Issuer"},null,8,["items","modelValue"]),e(E,{modelValue:t.value.role,"onUpdate:modelValue":u[3]||(u[3]=l=>t.value.role=l),items:["issuer","admin"],label:"Role"},null,8,["modelValue"])]),_:1}),e(P,null,{default:a(()=>[e(c),e(g,{onClick:l=>m(f),class:"bg-primary"},{default:a(()=>[v(" ADD ")]),_:2},1032,["onClick"]),e(g,{onClick:l=>f.value=!1,variant:"text",color:"primary"},{default:a(()=>[v(" CANCEL ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1536)]),_:2},1024),e(c)]),_:2},1024)]),_:1}))}}),X=U("div",{class:"mb-3"},"Credentials",-1),Y=U("div",{class:"mb-3"},"Personal Info",-1),Z=I({__name:"UpdateUser",props:{user:{},issuers:{}},emits:["update:user","update:show","userUpdated"],setup(i,{emit:o}){var u;const d=_(),t=o,n=i,s=_({email:n.user.email,name:n.user.name,role:n.user.role,issuerId:((u=n.user.issuer)==null?void 0:u.id)||null}),m=z();async function b(f){const{valid:l}=await d.value.validate();if(l){const p=A(s.value);K(n.user.id,p).then(r=>{if(!r.data.success)throw Error;t("userUpdated",p),d.value.reset(),m.showSnackbar("User data has been updated!","success")}).catch(()=>{m.showSnackbar("Update user failed!","error")}).finally(()=>{f.value=!1})}}return(f,l)=>($(),h(F,{activator:"parent"},{default:a(({isActive:p})=>[e(y,null,{default:a(()=>[e(c),e(C,{cols:"12",xxl:"4",xl:"4",lg:"4",md:"4",sm:"7"},{default:a(()=>[e(S,{ref_key:"myForm",ref:d},{default:a(()=>[e(T,{"max-height":"90vh",class:"overflow-auto"},{default:a(()=>[e(B,null,{default:a(()=>[e(L,null,{default:a(()=>[v(" Update User ")]),_:1})]),_:1}),e(x,null,{default:a(()=>[X,e(k,{class:"mb-3",rules:V(N),modelValue:s.value.email,"onUpdate:modelValue":l[0]||(l[0]=r=>s.value.email=r),type:"email",label:"Email"},null,8,["rules","modelValue"])]),_:1}),e(x,{class:"pt-0"},{default:a(()=>[Y,e(k,{class:"mb-3",rules:V(D),modelValue:s.value.name,"onUpdate:modelValue":l[1]||(l[1]=r=>s.value.name=r),label:"Name"},null,8,["rules","modelValue"]),e(R,{items:n.issuers,"item-title":"name","item-value":"id",class:"mb-3",modelValue:s.value.issuerId,"onUpdate:modelValue":l[2]||(l[2]=r=>s.value.issuerId=r),label:"Issuer"},null,8,["items","modelValue"]),e(E,{disabled:"",modelValue:s.value.role,"onUpdate:modelValue":l[3]||(l[3]=r=>s.value.role=r),items:["issuer","admin"],label:"Role"},null,8,["modelValue"])]),_:1}),e(P,null,{default:a(()=>[e(c),e(g,{onClick:r=>b(p),class:"bg-primary"},{default:a(()=>[v(" UPDATE ")]),_:2},1032,["onClick"]),e(g,{onClick:r=>p.value=!1,variant:"text",color:"primary"},{default:a(()=>[v(" CANCEL ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1536)]),_:2},1024),e(c)]),_:2},1024)]),_:1}))}}),ee=U("div",{class:"text-h5 font-weight-bold"},"User Management",-1),be=I({__name:"UserManagement",setup(i){const o=_([]),d=_(!0);return G().then(t=>{o.value=t.data.result.issuers}).finally(()=>{d.value=!1}),(t,n)=>($(),h(q,{fluid:""},{default:a(()=>[e(y,null,{default:a(()=>[e(C,null,{default:a(()=>[ee]),_:1})]),_:1}),e(y,null,{default:a(()=>[e(C,null,{default:a(()=>[e(M,{"load-api":V(H)},{add:a(({loadUsers:s})=>[e(W,{issuers:o.value,onUserAdded:s},null,8,["issuers","onUserAdded"])]),update:a(({loadUsers:s,user:m})=>[e(Z,{issuers:o.value,onUserUpdated:s,user:m},null,8,["issuers","onUserUpdated","user"])]),delete:a(({loadUsers:s,user:m})=>[e(j,{onUserDeleted:s,user:m},null,8,["onUserDeleted","user"])]),_:1},8,["load-api"])]),_:1})]),_:1})]),_:1}))}});export{be as default};
