import{a as q}from"./group-e736e658.js";import{s as z,t as H}from"./lazy-eda09f13.js";import{d as J,l as K,r as c,w as Q,o as l,h as i,g as e,f as a,a as u,m as _,j as o,i as k,S as p,ad as R,c as v,Y as x,ag as P,ah as I}from"./index-69d1502a.js";import{p as W}from"./permission-2c18b797.js";import{a as A,b as C}from"./VRow-1f387fa0.js";import{a as X,V as Z}from"./VDataTableServer-921b4e3b.js";import{V as L}from"./VTextField-f7af6f26.js";import{V as E,p as M,y as ee}from"./VBtn-421a5577.js";import{d as g,V as b}from"./index-6405a72a.js";import{V as T}from"./VChip-b541bb3f.js";const te={class:"d-flex justify-center flex-wrap"},ae=["colspan"],le={key:1,class:"my-3 mb-10"},se=u("div",null,"Description :",-1),oe=u("div",null,"Permissions :",-1),re={class:"d-flex"},ne=u("div",null,"Users :",-1),de={class:"d-flex my-2 align-center flex-wrap"},ye=J({__name:"ViewGroup",props:{listGroup:{type:Function}},setup(F){const B=K(),m=B.permissions,j=F,D=c(10),$=c(100),U=c(!0),G=c([]),w=c({}),h=[{title:"NAME",key:"name"},{title:"NUMBER OF MEMBER",key:"membersCount",align:"center"},{title:"STATUS",key:"state",sortable:!1,align:"center"}];B.user.role=="admin"&&h.splice(2,0,{title:"ISSUER",key:"issuer",sortable:!1,align:"center"}),(m["group.update"]||m["group.reactivate"])&&h.push({title:"UPDATE",key:"update",sortable:!1,align:"center"}),m["group.delete"]&&h.push({title:"DELETE",key:"delete",sortable:!1,align:"center"});function S(){U.value=!0,j.listGroup().then(s=>{const r=s.data.result;G.value=r.groups}).finally(()=>{setTimeout(()=>{U.value=!1},2e3)})}const f=c({}),N=c([]);Q(N,(s,r)=>{if(s.length>r.length){const t=I(s,r)[0];q(t.id).then(n=>{const d=n.data.result;setTimeout(()=>{f.value[t.id]=d},2e3)})}else{const t=I(r,s)[0];delete f.value[t.id]}},{deep:!0});function O(s){N.value=s}function Y(s,r){return s.reduce((t,n)=>t||r[n.value],!1)}return(s,r)=>(l(),i(b,null,{default:e(()=>[a(g,null,{default:e(()=>[a(A,null,{default:e(()=>[a(X),a(C,{cols:"12",xxl:"4",xl:"4",lg:"4",md:"4"},{default:e(()=>[u("div",te,[a(L,{placeholder:"Search group name","hide-details":"",variant:"outlined",density:"compact"}),_(m)["group.create"]?(l(),i(E,{key:0,variant:"tonal",class:"bg-primary ms-2",to:{name:"group.create"}},{default:e(()=>[o(" CREATE GROUP ")]),_:1},8,["to"])):k("",!0)])]),_:1})]),_:1})]),_:1}),a(g,null,{default:e(()=>[a(Z,{"return-object":"","show-select":"",color:"secondary","items-per-page":D.value,"onUpdate:itemsPerPage":r[0]||(r[0]=t=>D.value=t),headers:h,"items-length":$.value,items:G.value,loading:U.value,"item-value":"name","show-expand":"","onUpdate:options":S,"onUpdate:expanded":O},{loading:e(()=>[o(" Loading user groups... ")]),"item.state":e(({item:t})=>[t.state=="active"?(l(),i(T,{key:0,color:"success",label:""},{default:e(()=>[o("Active")]),_:1})):t.state=="deleted"?(l(),i(T,{key:1,color:"error",label:""},{default:e(()=>[o("Deleted")]),_:1})):k("",!0)]),"item.issuer":e(({item:t})=>[o(p(t.issuer.name),1)]),"item.update":e(({item:t})=>[t.state=="deleted"&&_(m)["group.reactivate"]?(l(),i(E,{key:0,variant:"tonal",color:"blue"},{default:e(()=>[o(" Reactivate "),R(s.$slots,"reactivate",{group:t,loadGroups:S})]),_:2},1024)):_(m)["group.update"]?(l(),i(E,{key:1,disabled:t.state=="deleted",color:"secondary",variant:"text",icon:"",to:{name:"group.update",params:{groupId:t.id}}},{default:e(()=>[a(M,null,{default:e(()=>[o(p(_(z)),1)]),_:1})]),_:2},1032,["disabled","to"])):k("",!0)]),"item.delete":e(({item:t})=>[a(E,{disabled:t.state=="deleted",color:"secondary",variant:"text",icon:""},{default:e(()=>[a(M,null,{default:e(()=>[o(p(_(H)),1)]),_:1}),R(s.$slots,"delete",{group:t,loadGroups:S})]),_:2},1032,["disabled"])]),"expanded-row":e(({item:t})=>[u("td",{colspan:h.length+2},[f.value[t.id]?(l(),v("div",le,[a(A,{class:"mx-0"},{default:e(()=>[a(C,null,{default:e(()=>[a(b,{variant:"outlined"},{default:e(()=>[a(g,null,{default:e(()=>[se,o(" "+p(t.description),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),a(A,{class:"mx-0"},{default:e(()=>[a(C,null,{default:e(()=>[a(b,{variant:"outlined"},{default:e(()=>[a(g,null,{default:e(()=>[oe,u("div",null,[(l(!0),v(x,null,P(_(W),(n,d)=>(l(),v(x,{key:d},[Y(n.actions,f.value[t.id].permissions)?(l(),i(b,{key:0,variant:"flat"},{default:e(()=>[a(g,null,{default:e(()=>[u("div",null,p(n.menuName),1),u("div",re,[(l(!0),v(x,null,P(n.actions,(y,V)=>(l(),v(x,{key:V},[f.value[t.id].permissions[y.value]?(l(),i(T,{key:0,class:"my-2 me-2",label:""},{default:e(()=>[o(p(y.title),1)]),_:2},1024)):k("",!0)],64))),128))])]),_:2},1024)]),_:2},1024)):k("",!0)],64))),128))])]),_:2},1024)]),_:2},1024)]),_:2},1024),a(C,null,{default:e(()=>[a(b,{variant:"outlined"},{default:e(()=>[a(g,null,{default:e(()=>{var n;return[ne,a(L,{class:"w-25 my-2",label:"Search user",modelValue:w.value[t.id],"onUpdate:modelValue":d=>w.value[t.id]=d,"hide-details":"",density:"compact"},null,8,["modelValue","onUpdate:modelValue"]),u("div",de,[(l(!0),v(x,null,P((n=f.value[t.id].members)==null?void 0:n.filter(d=>{var y,V;return(V=d.name)==null?void 0:V.toLowerCase().match((y=w.value[t.id])==null?void 0:y.toLowerCase())}),d=>(l(),i(T,{key:d.id,class:"me-2 my-2",label:"",color:"primary"},{default:e(()=>[o(p(d.name),1)]),_:2},1024))),128))])]}),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)])):(l(),i(ee,{key:0,height:2,indeterminate:""}))],8,ae)]),_:2},1032,["items-per-page","items-length","items","loading"])]),_:3})]),_:3}))}});export{ye as _};
