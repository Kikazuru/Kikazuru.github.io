import{a as Q,b as W}from"./group-2577dbdb.js";import{t as X,v as Z}from"./lazy-bd4f37e9.js";import{d as ee,l as te,r as i,w as j,o as s,h as u,g as t,f as a,a as d,m as v,j as n,i as b,S as c,aa as F,c as g,Y as x,ag as D,ah as $}from"./index-3573355a.js";import{_ as ae}from"./FilterHeaderCheckbox.vue_vue_type_script_setup_true_lang-1228bb4a.js";import{p as le}from"./permission-4358f34e.js";import{a as B,b as E}from"./VRow-3e89ef20.js";import{a as se,V as oe}from"./VDataTableServer-0715b14a.js";import{V as O}from"./VTextField-e0e32189.js";import{V as S,p as Y,y as re}from"./VBtn-4acdbe86.js";import{d as _,V}from"./index-8e303578.js";import{V as T}from"./VChip-5b2c32d2.js";const ne={class:"d-flex justify-center flex-wrap"},de=["colspan"],ie={key:1,class:"my-3 mb-10"},ue=d("div",null,"Description :",-1),ce=d("div",null,"Permissions :",-1),pe={class:"d-flex"},me=d("div",null,"Users :",-1),fe={class:"d-flex my-2 align-center flex-wrap"},ve={class:"d-flex justify-center align-center"},Se=ee({__name:"ViewGroup",props:{listGroup:{type:Function}},setup(q){const M=te(),m=M.permissions,z=q,w=i(1),P=i(10),N=i(100),k=i(!0),R=i([]),G=i({}),I=[{label:"Active",value:"active"},{label:"Deleted",value:"deleted"}],U=i(I.map(r=>r.value));j(U,()=>{C()});const h=[{title:"NAME",key:"name"},{title:"NUMBER OF MEMBER",key:"membersCount",align:"center"},{title:"STATUS",key:"state",sortable:!1,align:"center"}];M.user.role=="admin"&&h.splice(2,0,{title:"ISSUER",key:"issuer",sortable:!1,align:"center"}),(m["group.update"]||m["group.reactivate"])&&h.push({title:"UPDATE",key:"update",sortable:!1,align:"center"}),m["group.delete"]&&h.push({title:"DELETE",key:"delete",sortable:!1,align:"center"});function C(){k.value=!0,z.listGroup({limit:P.value,page:w.value,states:U.value}).then(r=>{const o=r.data.result;R.value=o.groups||[],N.value=o.recordsCount}).finally(()=>{setTimeout(()=>{k.value=!1},2e3)})}const y=i({}),A=i({}),L=i([]);j(L,(r,o)=>{if(r.length>o.length){const e=$(r,o)[0];Q(e.id).then(l=>{const f=l.data.result;W(e.id).then(p=>{setTimeout(()=>{y.value[e.id]=f,A.value[e.id]=p.data.result.members},2e3)})})}else{const e=$(o,r)[0];delete y.value[e.id],delete A.value[e.id]}},{deep:!0});function H(r){L.value=r}function J(r,o){return r.reduce((e,l)=>e||o[l.value],!1)}return(r,o)=>(s(),u(V,null,{default:t(()=>[a(_,null,{default:t(()=>[a(B,null,{default:t(()=>[a(se),a(E,{cols:"12",xxl:"4",xl:"4",lg:"4",md:"4"},{default:t(()=>[d("div",ne,[a(O,{placeholder:"Search group name","hide-details":"",variant:"outlined",density:"compact"}),v(m)["group.create"]?(s(),u(S,{key:0,variant:"tonal",class:"bg-primary ms-2",to:{name:"group.create"}},{default:t(()=>[n(" CREATE GROUP ")]),_:1},8,["to"])):b("",!0)])]),_:1})]),_:1})]),_:1}),a(_,null,{default:t(()=>[a(oe,{"return-object":"","show-select":"",color:"secondary",page:w.value,"onUpdate:page":o[1]||(o[1]=e=>w.value=e),"items-per-page":P.value,"onUpdate:itemsPerPage":o[2]||(o[2]=e=>P.value=e),headers:h,"items-length":N.value,items:R.value,loading:k.value,"item-value":"name","show-expand":"","onUpdate:options":C,"onUpdate:expanded":H},{loading:t(()=>[n(" Loading user groups... ")]),"item.state":t(({item:e})=>[e.state=="active"?(s(),u(T,{key:0,color:"success",label:""},{default:t(()=>[n("Active")]),_:1})):e.state=="deleted"?(s(),u(T,{key:1,color:"error",label:""},{default:t(()=>[n("Deleted")]),_:1})):b("",!0)]),"item.issuer":t(({item:e})=>[n(c(e.issuer.name),1)]),"item.update":t(({item:e})=>[e.state=="deleted"&&v(m)["group.reactivate"]?(s(),u(S,{key:0,variant:"tonal",color:"blue"},{default:t(()=>[n(" Reactivate "),F(r.$slots,"reactivate",{group:e,loadGroups:C})]),_:2},1024)):v(m)["group.update"]?(s(),u(S,{key:1,disabled:e.state=="deleted",color:"secondary",variant:"text",icon:"",to:{name:"group.update",params:{groupId:e.id}}},{default:t(()=>[a(Y,null,{default:t(()=>[n(c(v(X)),1)]),_:1})]),_:2},1032,["disabled","to"])):b("",!0)]),"item.delete":t(({item:e})=>[a(S,{disabled:e.state=="deleted",color:"secondary",variant:"text",icon:""},{default:t(()=>[a(Y,null,{default:t(()=>[n(c(v(Z)),1)]),_:1}),F(r.$slots,"delete",{group:e,loadGroups:C})]),_:2},1032,["disabled"])]),"expanded-row":t(({item:e})=>[d("td",{colspan:h.length+2},[y.value[e.id]?(s(),g("div",ie,[a(B,{class:"mx-0"},{default:t(()=>[a(E,null,{default:t(()=>[a(V,{variant:"outlined"},{default:t(()=>[a(_,null,{default:t(()=>[ue,n(" "+c(e.description),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),a(B,{class:"mx-0"},{default:t(()=>[a(E,null,{default:t(()=>[a(V,{variant:"outlined"},{default:t(()=>[a(_,null,{default:t(()=>[ce,d("div",null,[(s(!0),g(x,null,D(v(le),(l,f)=>(s(),g(x,{key:f},[J(l.actions,y.value[e.id].permissions)?(s(),u(V,{key:0,variant:"flat"},{default:t(()=>[a(_,null,{default:t(()=>[d("div",null,c(l.menuName),1),d("div",pe,[(s(!0),g(x,null,D(l.actions,(p,K)=>(s(),g(x,{key:K},[y.value[e.id].permissions[p.value]?(s(),u(T,{key:0,class:"my-2 me-2",label:""},{default:t(()=>[n(c(p.title),1)]),_:2},1024)):b("",!0)],64))),128))])]),_:2},1024)]),_:2},1024)):b("",!0)],64))),128))])]),_:2},1024)]),_:2},1024)]),_:2},1024),a(E,null,{default:t(()=>[a(V,{variant:"outlined"},{default:t(()=>[a(_,null,{default:t(()=>[me,a(O,{class:"w-25 my-2",label:"Search user",modelValue:G.value[e.id],"onUpdate:modelValue":l=>G.value[e.id]=l,"hide-details":"",density:"compact"},null,8,["modelValue","onUpdate:modelValue"]),d("div",fe,[(s(!0),g(x,null,D(A.value[e.id].filter(l=>{var f,p;return(p=l.name)==null?void 0:p.toLowerCase().match((f=G.value[e.id])==null?void 0:f.toLowerCase())}),l=>(s(),u(T,{key:l.id,class:"me-2 my-2",label:"",color:"primary"},{default:t(()=>[n(c(l.name),1)]),_:2},1024))),128))])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)])):(s(),u(re,{key:0,height:2,indeterminate:""}))],8,de)]),"header.state":t(({column:e})=>[d("span",ve,[d("div",null,c(e.title),1),a(ae,{disabled:k.value,items:I,modelValue:U.value,"onUpdate:modelValue":o[0]||(o[0]=l=>U.value=l)},null,8,["disabled","modelValue"])])]),_:2},1032,["page","items-per-page","items-length","items","loading"])]),_:3})]),_:3}))}});export{Se as _};
