import{_ as K,a as Q}from"./ReactivateUser.vue_vue_type_script_setup_true_lang-72865bf7.js";import{a as W,u as Y,g as Z}from"./user-f49a07c4.js";import{e as M,n as q,r as ee}from"./rules-3c02e6d9.js";import{_ as O}from"./IssuerInput.vue_vue_type_script_setup_true_lang-f322e8e1.js";import{u as X}from"./snackbar-82b4b4e3.js";import{a as k,b as z,V as ae}from"./VDataTableServer-209fc9bb.js";import{b as x,a as S,V as le}from"./VRow-cccfd752.js";import{V as G}from"./VForm-3ddb7e8c.js";import{V as I,a as F,b as L,d as $,j as H}from"./index-fc6a3455.js";import{V as E}from"./VTextField-d6d2aeeb.js";import{V as J}from"./filter-6f6c7ae3.js";import{V as g,p as B}from"./VBtn-4c1884a2.js";import{d as R,r as i,o as c,h as b,g as a,f as e,j as n,m as v,a as U,w as te,l as se,aa as D,i as T,S as C,c as P}from"./index-033028ba.js";import{q as oe,t as ue,v as re}from"./lazy-62b0a598.js";import{_ as de}from"./FilterHeaderCheckbox.vue_vue_type_script_setup_true_lang-479fae9c.js";import{V as N}from"./VChip-87521e80.js";import"./user-e8c69e1d.js";import"./api-f2d6da92.js";import"./issuer-6495046d.js";import"./VList-12c50827.js";import"./tag-13d67880.js";import"./VAutocomplete-dda41355.js";const ne=U("div",{class:"mb-3"},"Login Credentials",-1),ie=U("div",{class:"mb-3"},"Personal Info",-1),me=R({__name:"AddUser",emits:["userAdded"],setup(A,{emit:h}){const f=i(),d=i(""),r=i(""),m=i("issuer"),_=i(),V=h,p=X();async function y(w){var s;const{valid:u}=await f.value.validate();if(u){const t={name:d.value,email:r.value,role:m.value,issuerId:(s=_.value)==null?void 0:s.id};W(t).then(o=>{o.data.success&&(V("userAdded"),w.value=!1,f.value.reset(),p.showSnackbar("User data has been created!","success"))}).catch(()=>{p.showSnackbar("Create user failed!","error")})}}return(w,u)=>(c(),b(z,{activator:"parent"},{default:a(({isActive:s})=>[e(S,null,{default:a(()=>[e(k),e(x,{cols:"12",xxl:"4",xl:"4",lg:"4",md:"4",sm:"7"},{default:a(()=>[e(G,{ref_key:"myForm",ref:f},{default:a(()=>[e(I,{"max-height":"90vh",class:"overflow-auto"},{default:a(()=>[e(F,null,{default:a(()=>[e(L,null,{default:a(()=>[n(" Add User ")]),_:1})]),_:1}),e($,null,{default:a(()=>[ne,e(E,{rules:v(M),modelValue:r.value,"onUpdate:modelValue":u[0]||(u[0]=t=>r.value=t),type:"email",label:"Email"},null,8,["rules","modelValue"])]),_:1}),e($,{class:"pt-0"},{default:a(()=>[ie,e(E,{class:"mb-3",rules:v(q),modelValue:d.value,"onUpdate:modelValue":u[1]||(u[1]=t=>d.value=t),label:"Name"},null,8,["rules","modelValue"]),e(J,{modelValue:m.value,"onUpdate:modelValue":u[2]||(u[2]=t=>m.value=t),items:["issuer","admin"],label:"Role"},null,8,["modelValue"]),e(O,{rules:m.value!="admin"?v(ee):[],disabled:!m.value||m.value=="admin",modelValue:_.value,"onUpdate:modelValue":u[3]||(u[3]=t=>_.value=t)},null,8,["rules","disabled","modelValue"])]),_:1}),e(H,null,{default:a(()=>[e(k),e(g,{onClick:t=>s.value=!1,color:"primary"},{default:a(()=>[n(" CANCEL ")]),_:2},1032,["onClick"]),e(g,{onClick:t=>y(s),variant:"flat",color:"primary"},{default:a(()=>[n(" ADD ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1536)]),_:2},1024),e(k)]),_:2},1024)]),_:1}))}}),ce=U("div",{class:"mb-3"},"Credentials",-1),fe=U("div",{class:"mb-3"},"Personal Info",-1),pe=R({__name:"UpdateUser",props:{user:{}},emits:["update:user","update:show","userUpdated"],setup(A,{emit:h}){const f=i(),d=h,r=A,m=i(r.user.name),_=i(r.user.email),V=i(r.user.role),p=i(r.user.issuer),y=X();async function w(u){var t;const{valid:s}=await f.value.validate();if(s&&p.value!=null){const o={name:m.value,email:_.value,role:V.value,issuerId:(t=p.value)==null?void 0:t.id};Y(r.user.id,o).then(l=>{if(!l.data.success)throw Error;d("userUpdated",o),f.value.reset(),y.showSnackbar("User data has been updated!","success")}).catch(()=>{y.showSnackbar("Update user failed!","error")}).finally(()=>{u.value=!1})}}return(u,s)=>(c(),b(z,{activator:"parent"},{default:a(({isActive:t})=>[e(S,null,{default:a(()=>[e(k),e(x,{cols:"12",xxl:"4",xl:"4",lg:"4",md:"4",sm:"7"},{default:a(()=>[e(G,{ref_key:"myForm",ref:f},{default:a(()=>[e(I,{"max-height":"90vh",class:"overflow-auto"},{default:a(()=>[e(F,null,{default:a(()=>[e(L,null,{default:a(()=>[n(" Update User ")]),_:1})]),_:1}),e($,null,{default:a(()=>[ce,e(E,{class:"mb-3",rules:v(M),modelValue:_.value,"onUpdate:modelValue":s[0]||(s[0]=o=>_.value=o),type:"email",label:"Email"},null,8,["rules","modelValue"])]),_:1}),e($,{class:"pt-0"},{default:a(()=>[fe,e(E,{class:"mb-3",rules:v(q),modelValue:m.value,"onUpdate:modelValue":s[1]||(s[1]=o=>m.value=o),label:"Name"},null,8,["rules","modelValue"]),e(J,{disabled:"",modelValue:V.value,"onUpdate:modelValue":s[2]||(s[2]=o=>V.value=o),items:["issuer","admin"],label:"Role"},null,8,["modelValue"]),e(O,{disabled:!V.value||V.value=="admin",modelValue:p.value,"onUpdate:modelValue":s[3]||(s[3]=o=>p.value=o)},null,8,["disabled","modelValue"])]),_:1}),e(H,null,{default:a(()=>[e(k),e(g,{onClick:o=>t.value=!1,color:"primary"},{default:a(()=>[n(" CANCEL ")]),_:2},1032,["onClick"]),e(g,{onClick:o=>w(t),variant:"flat",color:"primary"},{default:a(()=>[n(" UPDATE ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1536)]),_:2},1024),e(k)]),_:2},1024)]),_:1}))}}),ve={class:"d-flex justify-center flex-wrap"},_e={class:"text-caption text-grey"},Ve={key:0},be={key:0},Ue={key:1},ge={key:1},ye={class:"d-flex justify-center align-center"},ke=R({__name:"ViewUser",props:{loadApi:{type:Function}},setup(A){const h=A,f=i(1),d=i(10),r=i(100),m=i(!0),_=i([]),V=[{label:"Active",value:"active"},{label:"Deleted",value:"deleted"},{label:"Pending",value:"pending"}],p=i(V.map(t=>t.value));te(p,()=>{s()});const y=[{title:"NAME",key:"name"},{title:"ISSUER",key:"issuer",align:"center",sortable:!1},{title:"STATUS",key:"state",sortable:!1,align:"center"}],u=se().permissions;(u["user.update"]||u["user.reactivate"])&&y.push({title:"UPDATE",key:"update",sortable:!1,align:"center"}),u["user.delete"]&&y.push({title:"DELETE",key:"delete",sortable:!1,align:"center"});function s(){m.value=!0,h.loadApi({limit:d.value,page:f.value,states:p.value}).then(t=>{_.value=t.data.result.users||[],r.value=t.data.result.recordsCount}).finally(()=>{setTimeout(()=>{m.value=!1},2e3)})}return(t,o)=>(c(),b(I,null,{default:a(()=>[e(F,null,{default:a(()=>[e(L,null,{default:a(()=>[n(" List Of Users ")]),_:1})]),_:1}),e($,{class:"mt-2"},{default:a(()=>[e(S,null,{default:a(()=>[e(x,null,{default:a(()=>[e(g,{variant:"outlined","prepend-icon":v(oe)},{default:a(()=>[n(" EXPORT ")]),_:1},8,["prepend-icon"])]),_:1}),e(k),e(x,{cols:"12",xxl:"4",xl:"4",lg:"4",md:"4"},{default:a(()=>[U("div",ve,[e(E,{placeholder:"Search user or group name","hide-details":"",variant:"outlined",density:"compact"}),v(u)["user.create"]?(c(),b(g,{key:0,variant:"tonal",class:"bg-primary ms-2"},{default:a(()=>[D(t.$slots,"add",{loadUsers:s}),n(" ADD USER ")]),_:3})):T("",!0)])]),_:3})]),_:3})]),_:3}),e($,null,{default:a(()=>[e(ae,{"return-object":"","show-select":"",color:"secondary","items-per-page":d.value,"onUpdate:itemsPerPage":o[1]||(o[1]=l=>d.value=l),page:f.value,"onUpdate:page":o[2]||(o[2]=l=>f.value=l),headers:y,"items-length":r.value,items:_.value,loading:m.value,"item-value":"name","onUpdate:options":s},{loading:a(()=>[n(" Loading users... ")]),"item.name":a(({item:l})=>[U("div",null,C(l.name),1),U("div",_e,C(l.email),1)]),"item.state":a(({item:l})=>[l.state=="active"?(c(),b(N,{key:0,color:"success",label:""},{default:a(()=>[n("Active")]),_:1})):l.state=="pending"?(c(),b(N,{key:1,color:"warning",label:""},{default:a(()=>[n("Pending")]),_:1})):l.state=="deleted"?(c(),b(N,{key:2,color:"error",label:""},{default:a(()=>[n("Deleted")]),_:1})):T("",!0)]),"item.issuer":a(({item:l})=>[l.role=="issuer"?(c(),P("div",Ve,[l.issuer?(c(),P("div",be,C(l.issuer.name),1)):(c(),P("div",Ue,"-"))])):l.role=="admin"?(c(),P("div",ge,[e(N,{label:"",color:"blue"},{default:a(()=>[n("Admin")]),_:1})])):T("",!0)]),"item.update":a(({item:l})=>[l.state=="deleted"&&v(u)["user.reactivate"]?(c(),b(g,{key:0,variant:"tonal",color:"blue"},{default:a(()=>[n(" Reactivate "),D(t.$slots,"reactivate",{user:l,loadUsers:s})]),_:2},1024)):v(u)["user.update"]?(c(),b(g,{key:1,disabled:l.state=="deleted",color:"secondary",variant:"text",icon:""},{default:a(()=>[e(B,null,{default:a(()=>[n(C(v(ue)),1)]),_:1}),D(t.$slots,"update",{user:l,loadUsers:s})]),_:2},1032,["disabled"])):T("",!0)]),"item.delete":a(({item:l})=>[e(g,{disabled:l.state=="deleted",color:"secondary",variant:"text",icon:""},{default:a(()=>[e(B,null,{default:a(()=>[n(C(v(re)),1)]),_:1}),D(t.$slots,"delete",{user:l,loadUsers:s})]),_:2},1032,["disabled"])]),"header.state":a(({column:l})=>[U("span",ye,[U("div",null,C(l.title),1),e(de,{disabled:m.value,items:V,modelValue:p.value,"onUpdate:modelValue":o[0]||(o[0]=j=>p.value=j)},null,8,["disabled","modelValue"])])]),_:2},1032,["items-per-page","page","items-length","items","loading"])]),_:3})]),_:3}))}}),he=U("div",{class:"text-h5 font-weight-bold"},"User Management",-1),Ge=R({__name:"UserManagement",setup(A){return(h,f)=>(c(),b(le,{fluid:""},{default:a(()=>[e(S,null,{default:a(()=>[e(x,null,{default:a(()=>[he]),_:1})]),_:1}),e(S,null,{default:a(()=>[e(x,null,{default:a(()=>[e(ke,{"load-api":v(Z)},{add:a(({loadUsers:d})=>[e(me,{onUserAdded:d},null,8,["onUserAdded"])]),update:a(({loadUsers:d,user:r})=>[e(pe,{onUserUpdated:d,user:r},null,8,["onUserUpdated","user"])]),delete:a(({loadUsers:d,user:r})=>[e(K,{onUserDeleted:d,user:r},null,8,["onUserDeleted","user"])]),reactivate:a(({loadUsers:d,user:r})=>[e(Q,{onReactivated:d,user:r},null,8,["onReactivated","user"])]),_:1},8,["load-api"])]),_:1})]),_:1})]),_:1}))}});export{Ge as default};
