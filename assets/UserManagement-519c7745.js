import{_ as W,a as Y}from"./ReactivateUser.vue_vue_type_script_setup_true_lang-dc032174.js";import{d as B,r,o as i,h as v,g as a,f as e,j as n,m as _,a as V,ae as O,i as P,w as Z,l as ee,ad as T,S as $,c as N}from"./index-69d1502a.js";import{a as ae,u as le,g as te}from"./user-4dbb0d25.js";import{e as q,n as X}from"./rules-3c02e6d9.js";import{l as z}from"./issuer-07d3c33d.js";import{a as C,b as G,V as se}from"./VDataTableServer-921b4e3b.js";import{b as I,a as S,V as ue}from"./VRow-1f387fa0.js";import{V as H}from"./VForm-acfbacb3.js";import{V as F,a as L,b as j,d as w,j as J}from"./index-6405a72a.js";import{V as D}from"./VTextField-f7af6f26.js";import{V as K}from"./filter-bfc06a5f.js";import{V as Q}from"./VAutocomplete-e056e3cf.js";import{V as U,p as M}from"./VBtn-421a5577.js";import{u as oe}from"./snackbar-867af268.js";import{q as re,s as de,t as ne}from"./lazy-eda09f13.js";import{_ as ie}from"./FilterHeaderCheckbox.vue_vue_type_script_setup_true_lang-e8950ebf.js";import{V as R}from"./VChip-b541bb3f.js";import"./user-2f0087e0.js";import"./api-77cd4ed9.js";import"./VList-0497e142.js";import"./tag-446592ee.js";const me=V("div",{class:"mb-3"},"Login Credentials",-1),ce=V("div",{class:"mb-3"},"Personal Info",-1),pe=B({__name:"AddUser",emits:["userAdded"],setup(E,{emit:x}){const p=r(),t=r({name:"",email:"",role:"issuer",issuerId:""}),d=r([]),b=r(!0),y=r(1),A=r(10);function g(){z({limit:A.value,page:y.value,states:["active"]}).then(c=>{const o=c.data.result.issuers;o?(d.value.push(...o),y.value++,g()):b.value=!1})}const k=x;async function m(c){const{valid:u}=await p.value.validate();if(u){const o=O(t.value);ae(o).then(s=>{s.data.success&&(k("userAdded"),c.value=!1,p.value.reset())})}}return(c,u)=>(i(),v(G,{activator:"parent"},{default:a(({isActive:o})=>[e(S,null,{default:a(()=>[e(C),e(I,{cols:"12",xxl:"4",xl:"4",lg:"4",md:"4",sm:"7"},{default:a(()=>[e(H,{ref_key:"myForm",ref:p},{default:a(()=>[e(F,{onVnodeBeforeMount:u[4]||(u[4]=s=>g()),"max-height":"90vh",class:"overflow-auto"},{default:a(()=>[e(L,null,{default:a(()=>[e(j,null,{default:a(()=>[n(" Add User ")]),_:1})]),_:1}),e(w,null,{default:a(()=>[me,e(D,{rules:_(q),modelValue:t.value.email,"onUpdate:modelValue":u[0]||(u[0]=s=>t.value.email=s),type:"email",label:"Email"},null,8,["rules","modelValue"])]),_:1}),e(w,{class:"pt-0"},{default:a(()=>[ce,e(D,{class:"mb-3",rules:_(X),modelValue:t.value.name,"onUpdate:modelValue":u[1]||(u[1]=s=>t.value.name=s),label:"Name"},null,8,["rules","modelValue"]),e(K,{modelValue:t.value.role,"onUpdate:modelValue":u[2]||(u[2]=s=>t.value.role=s),items:["issuer","admin"],label:"Role"},null,8,["modelValue"]),e(Q,{disabled:!t.value.role||t.value.role=="admin",items:d.value,"item-title":"name","item-value":"id",class:"mb-3",modelValue:t.value.issuerId,"onUpdate:modelValue":u[3]||(u[3]=s=>t.value.issuerId=s),label:"Issuer"},null,8,["disabled","items","modelValue"])]),_:1}),e(J,null,{default:a(()=>[e(C),e(U,{onClick:s=>m(o),class:"bg-primary"},{default:a(()=>[n(" ADD ")]),_:2},1032,["onClick"]),e(U,{onClick:s=>o.value=!1,variant:"text",color:"primary"},{default:a(()=>[n(" CANCEL ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1536)]),_:2},1536)]),_:2},1024),e(C)]),_:2},1024)]),_:1}))}}),fe=V("div",{class:"mb-3"},"Credentials",-1),ve=V("div",{class:"mb-3"},"Personal Info",-1),_e=B({__name:"UpdateUser",props:{user:{}},emits:["update:user","update:show","userUpdated"],setup(E,{emit:x}){var o;const p=r(),t=x,d=E,b=r([]),y=r(!0),A=r(1),g=r(10);function k(){z({limit:g.value,page:A.value,states:["active"]}).then(s=>{b.value=s.data.result.issuers}).finally(()=>{y.value=!1})}const m=r({email:d.user.email,name:d.user.name,role:d.user.role,issuerId:((o=d.user.issuer)==null?void 0:o.id)||null}),c=oe();async function u(s){const{valid:l}=await p.value.validate();if(l){const h=O(m.value);le(d.user.id,h).then(f=>{if(!f.data.success)throw Error;t("userUpdated",h),p.value.reset(),c.showSnackbar("User data has been updated!","success")}).catch(()=>{c.showSnackbar("Update user failed!","error")}).finally(()=>{s.value=!1})}}return(s,l)=>(i(),v(G,{activator:"parent"},{default:a(({isActive:h})=>[e(S,null,{default:a(()=>[e(C),e(I,{cols:"12",xxl:"4",xl:"4",lg:"4",md:"4",sm:"7"},{default:a(()=>[e(H,{ref_key:"myForm",ref:p},{default:a(()=>[e(F,{onVnodeBeforeMount:l[4]||(l[4]=f=>k()),"max-height":"90vh",class:"overflow-auto"},{default:a(()=>[e(L,null,{default:a(()=>[e(j,null,{default:a(()=>[n(" Update User ")]),_:1})]),_:1}),e(w,null,{default:a(()=>[fe,e(D,{class:"mb-3",rules:_(q),modelValue:m.value.email,"onUpdate:modelValue":l[0]||(l[0]=f=>m.value.email=f),type:"email",label:"Email"},null,8,["rules","modelValue"])]),_:1}),e(w,{class:"pt-0"},{default:a(()=>[ve,e(D,{class:"mb-3",rules:_(X),modelValue:m.value.name,"onUpdate:modelValue":l[1]||(l[1]=f=>m.value.name=f),label:"Name"},null,8,["rules","modelValue"]),e(K,{disabled:"",modelValue:m.value.role,"onUpdate:modelValue":l[2]||(l[2]=f=>m.value.role=f),items:["issuer","admin"],label:"Role"},null,8,["modelValue"]),m.value.role=="issuer"?(i(),v(Q,{key:0,disabled:!m.value.role||s.user.role=="admin",items:b.value,"item-title":"name","item-value":"id",class:"mb-3",modelValue:m.value.issuerId,"onUpdate:modelValue":l[3]||(l[3]=f=>m.value.issuerId=f),label:"Issuer"},null,8,["disabled","items","modelValue"])):P("",!0)]),_:1}),e(J,null,{default:a(()=>[e(C),e(U,{onClick:f=>u(h),class:"bg-primary"},{default:a(()=>[n(" UPDATE ")]),_:2},1032,["onClick"]),e(U,{onClick:f=>h.value=!1,variant:"text",color:"primary"},{default:a(()=>[n(" CANCEL ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1536)]),_:2},1536)]),_:2},1024),e(C)]),_:2},1024)]),_:1}))}}),Ve={class:"d-flex justify-center flex-wrap"},be={class:"text-caption text-grey"},ge={key:0},Ue={key:0},ye={key:1},ke={key:1},he={class:"d-flex justify-center align-center"},Ce=B({__name:"ViewUser",props:{loadApi:{type:Function}},setup(E){const x=E,p=r(1),t=r(10),d=r(100),b=r(!0),y=r([]),A=[{label:"Active",value:"active"},{label:"Deleted",value:"deleted"},{label:"Pending",value:"pending"}],g=r(A.map(o=>o.value));Z(g,()=>{u()});const k=[{title:"NAME",key:"name"},{title:"ISSUER",key:"issuer",align:"center",sortable:!1},{title:"STATUS",key:"state",sortable:!1,align:"center"}],c=ee().permissions;(c["user.update"]||c["user.reactivate"])&&k.push({title:"UPDATE",key:"update",sortable:!1,align:"center"}),c["user.delete"]&&k.push({title:"DELETE",key:"delete",sortable:!1,align:"center"});function u(){b.value=!0,x.loadApi({limit:t.value,page:p.value,states:g.value}).then(o=>{y.value=o.data.result.users||[],d.value=o.data.result.recordsCount}).finally(()=>{setTimeout(()=>{b.value=!1},2e3)})}return(o,s)=>(i(),v(F,null,{default:a(()=>[e(L,null,{default:a(()=>[e(j,null,{default:a(()=>[n(" List Of Users ")]),_:1})]),_:1}),e(w,{class:"mt-2"},{default:a(()=>[e(S,null,{default:a(()=>[e(I,null,{default:a(()=>[e(U,{variant:"outlined","prepend-icon":_(re)},{default:a(()=>[n(" EXPORT ")]),_:1},8,["prepend-icon"])]),_:1}),e(C),e(I,{cols:"12",xxl:"4",xl:"4",lg:"4",md:"4"},{default:a(()=>[V("div",Ve,[e(D,{placeholder:"Search user or group name","hide-details":"",variant:"outlined",density:"compact"}),_(c)["user.create"]?(i(),v(U,{key:0,variant:"tonal",class:"bg-primary ms-2"},{default:a(()=>[T(o.$slots,"add",{loadUsers:u}),n(" ADD USER ")]),_:3})):P("",!0)])]),_:3})]),_:3})]),_:3}),e(w,null,{default:a(()=>[e(se,{"return-object":"","show-select":"",color:"secondary","items-per-page":t.value,"onUpdate:itemsPerPage":s[1]||(s[1]=l=>t.value=l),page:p.value,"onUpdate:page":s[2]||(s[2]=l=>p.value=l),headers:k,"items-length":d.value,items:y.value,loading:b.value,"item-value":"name","onUpdate:options":u},{loading:a(()=>[n(" Loading users... ")]),"item.name":a(({item:l})=>[V("div",null,$(l.name),1),V("div",be,$(l.email),1)]),"item.state":a(({item:l})=>[l.state=="active"?(i(),v(R,{key:0,color:"success",label:""},{default:a(()=>[n("Active")]),_:1})):l.state=="pending"?(i(),v(R,{key:1,color:"warning",label:""},{default:a(()=>[n("Pending")]),_:1})):l.state=="deleted"?(i(),v(R,{key:2,color:"error",label:""},{default:a(()=>[n("Deleted")]),_:1})):P("",!0)]),"item.issuer":a(({item:l})=>[l.role=="issuer"?(i(),N("div",ge,[l.issuer?(i(),N("div",Ue,$(l.issuer.name),1)):(i(),N("div",ye,"-"))])):l.role=="admin"?(i(),N("div",ke,[e(R,{label:"",color:"blue"},{default:a(()=>[n("Admin")]),_:1})])):P("",!0)]),"item.update":a(({item:l})=>[l.state=="deleted"&&_(c)["user.reactivate"]?(i(),v(U,{key:0,variant:"tonal",color:"blue"},{default:a(()=>[n(" Reactivate "),T(o.$slots,"reactivate",{user:l,loadUsers:u})]),_:2},1024)):_(c)["user.update"]?(i(),v(U,{key:1,disabled:l.state=="deleted",color:"secondary",variant:"text",icon:""},{default:a(()=>[e(M,null,{default:a(()=>[n($(_(de)),1)]),_:1}),T(o.$slots,"update",{user:l,loadUsers:u})]),_:2},1032,["disabled"])):P("",!0)]),"item.delete":a(({item:l})=>[e(U,{disabled:l.state=="deleted",color:"secondary",variant:"text",icon:""},{default:a(()=>[e(M,null,{default:a(()=>[n($(_(ne)),1)]),_:1}),T(o.$slots,"delete",{user:l,loadUsers:u})]),_:2},1032,["disabled"])]),"header.state":a(({column:l})=>[V("span",he,[V("div",null,$(l.title),1),e(ie,{disabled:b.value,items:A,modelValue:g.value,"onUpdate:modelValue":s[0]||(s[0]=h=>g.value=h)},null,8,["disabled","modelValue"])])]),_:2},1032,["items-per-page","page","items-length","items","loading"])]),_:3})]),_:3}))}}),xe=V("div",{class:"text-h5 font-weight-bold"},"User Management",-1),Je=B({__name:"UserManagement",setup(E){return(x,p)=>(i(),v(ue,{fluid:""},{default:a(()=>[e(S,null,{default:a(()=>[e(I,null,{default:a(()=>[xe]),_:1})]),_:1}),e(S,null,{default:a(()=>[e(I,null,{default:a(()=>[e(Ce,{"load-api":_(te)},{add:a(({loadUsers:t})=>[e(pe,{onUserAdded:t},null,8,["onUserAdded"])]),update:a(({loadUsers:t,user:d})=>[e(_e,{onUserUpdated:t,user:d},null,8,["onUserUpdated","user"])]),delete:a(({loadUsers:t,user:d})=>[e(W,{onUserDeleted:t,user:d},null,8,["onUserDeleted","user"])]),reactivate:a(({loadUsers:t,user:d})=>[e(Y,{onReactivated:t,user:d},null,8,["onReactivated","user"])]),_:1},8,["load-api"])]),_:1})]),_:1})]),_:1}))}});export{Je as default};
