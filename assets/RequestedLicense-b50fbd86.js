import{a8 as N,d as L,r as m,o as i,h as v,g as e,f as t,j as s,a as b,S as _,m as k,l as M,R as O,aa as Q,i as x,c as j}from"./index-033028ba.js";import{u as A}from"./snackbar-82b4b4e3.js";import{_ as G,V as H}from"./VFileInput-47e34efd.js";import{a as R,b as B,V as J}from"./VDataTableServer-209fc9bb.js";import{b as $,a as E,V as K}from"./VRow-cccfd752.js";import{V as P,a as D,b as F,d as I,j as z}from"./index-fc6a3455.js";import{V as W}from"./VForm-3ddb7e8c.js";import{V as g,p as U}from"./VBtn-4c1884a2.js";import{s as X,n as Y,r as Z}from"./lazy-62b0a598.js";import{_ as ee}from"./MessageDialog.vue_vue_type_script_setup_true_lang-0ac75953.js";import{_ as te}from"./FilterHeaderCheckbox.vue_vue_type_script_setup_true_lang-479fae9c.js";import{V as T}from"./VChip-87521e80.js";import"./VList-12c50827.js";import"./tag-13d67880.js";import"./VAutocomplete-dda41355.js";import"./filter-6f6c7ae3.js";import"./VTextField-d6d2aeeb.js";async function ae(n){return await N.post("/topup_requests",{quota:n})}async function se({limit:n=10,page:q=1,states:o}){return await N.get("/topup_requests",{params:{limit:n,page:q,states:o}})}async function le(n){return await N.put(`/topup_requests/${n}/complete`)}const ne=L({__name:"CreateLicense",emits:["created"],setup(n,{emit:q}){const o=m(),r=m(),c=m([]),C=q,f=A();async function d(u){if(r.value!=null){const l=parseInt(r.value.toString());ae(l).then(()=>{C("created"),f.showSnackbar("Request license success","success"),o.value.reset(),u.value=!1}).catch(()=>{f.showSnackbar("Request license failed","error")})}}return(u,l)=>(i(),v(B,{activator:"parent"},{default:e(({isActive:h})=>[t(E,null,{default:e(()=>[t(R),t($,{cols:"12",xxl:"4",xl:"4",lg:"4",md:"4",sm:"7"},{default:e(()=>[t(P,null,{default:e(()=>[t(D,null,{default:e(()=>[t(F,null,{default:e(()=>[s(" Request License ")]),_:1})]),_:1}),t(I,null,{default:e(()=>[t(W,{ref_key:"myForm",ref:o},{default:e(()=>[t(G,{class:"mb-3",modelValue:r.value,"onUpdate:modelValue":l[0]||(l[0]=V=>r.value=V)},null,8,["modelValue"]),t(H,{modelValue:c.value,"onUpdate:modelValue":l[1]||(l[1]=V=>c.value=V),label:"Purchase Order Document","show-size":"","persistent-hint":"",hint:"Max file size 2 MB"},null,8,["modelValue"])]),_:1},512),t(z,null,{default:e(()=>[t(R),t(g,{onClick:V=>(h.value=!1,o.value.reset()),variant:"text",color:"primary"},{default:e(()=>[s("CANCEL")]),_:2},1032,["onClick"]),t(g,{onClick:V=>d(h),class:"bg-primary"},{default:e(()=>[s("REQUEST")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),t(R)]),_:2},1024)]),_:1}))}}),oe={class:"d-flex justify-end mb-2"},re=L({__name:"CompleteRequest",props:{requestedLicense:{}},emits:["update:show","confirmed"],setup(n,{emit:q}){const o=n,r=q,c=A();function C(f){le(o.requestedLicense.id).then(d=>{if(d.data.success)r("confirmed"),c.showSnackbar("Top-up request data has been confirmed!","success"),setTimeout(()=>{f.value=!1},1e3);else throw Error}).catch(()=>{c.showSnackbar("Confirmation top-up request failed!","error")})}return(f,d)=>(i(),v(B,{activator:"parent",width:"auto"},{default:e(({isActive:u})=>[t(P,{class:"text-center pa-4",rounded:"lg"},{default:e(()=>[b("div",oe,[t(U,{size:"small",onClick:l=>u.value=!1},{default:e(()=>[s(_(k(X)),1)]),_:2},1032,["onClick"])]),t(D,null,{default:e(()=>[t(F,null,{default:e(()=>[s(" Complete Top-Up Request ")]),_:1})]),_:1}),t(I,null,{default:e(()=>[s(" Please complete this request to activate your reserved licenses ")]),_:1}),t(z,null,{default:e(()=>[t(R),t(g,{onClick:l=>u.value=!1,color:"primary"},{default:e(()=>[s(" CANCEL ")]),_:2},1032,["onClick"]),t(g,{onClick:l=>C(u),variant:"flat",color:"primary"},{default:e(()=>[s(" COMPLETE ")]),_:2},1032,["onClick"]),t(R)]),_:2},1024)]),_:2},1024)]),_:1}))}}),ue={class:"d-flex justify-end"},ie={key:0},ce={key:1},de={class:"d-flex justify-center align-center"},pe=L({__name:"ViewRequestedLicense",props:{listRequestedLicense:{type:Function}},setup(n){const o=M().permissions,r=n,c=m(1),C=m(10),f=m(100),d=m(!0),u=m([]),l=[{label:"Approved",value:"approved"},{label:"Declined",value:"declined"},{label:"Pending",value:"pending"}],h=m(l.map(y=>y.value)),V=[{title:"REQUESTER",key:"requester"},{title:"ISSUER",key:"issuer"},{title:"QUOTA",key:"quota"},{title:"ADMIN",key:"actor"},{title:"STATUS",key:"state",sortable:!1,align:"center"}];function w(){d.value=!0,r.listRequestedLicense({page:c.value,limit:C.value,states:h.value}).then(async y=>{const p=y.data.result;u.value=p.topupRequests||[],f.value=p.recordsCount}).finally(()=>{setTimeout(()=>{d.value=!1},2e3)})}return O(()=>{w()}),(y,p)=>(i(),v(P,null,{default:e(()=>[t(D,null,{default:e(()=>[b("div",ue,[k(o)["topup_request.create"]?(i(),v(g,{key:0,color:"primary"},{default:e(()=>[s(" TopUp License "),Q(y.$slots,"create",{loadRequestedLicense:w})]),_:3})):x("",!0)])]),_:3}),t(I,null,{default:e(()=>[t(J,{"return-object":"","show-select":"",color:"secondary",page:c.value,"onUpdate:page":p[1]||(p[1]=a=>c.value=a),"items-per-page":C.value,"onUpdate:itemsPerPage":p[2]||(p[2]=a=>C.value=a),headers:V,"items-length":f.value,items:u.value,loading:d.value,"item-value":"name"},{loading:e(()=>[s(" Loading top-up license... ")]),"item.quota":e(({item:a})=>[s(_(a.quota.toLocaleString("id")),1)]),"item.state":e(({item:a})=>[a.state=="approved"?(i(),j("div",ie,[a.state=="approved"?(i(),v(T,{key:0,label:"",color:"success"},{default:e(()=>[s(" Accepted ")]),_:1})):x("",!0),t(g,{ripple:!1,icon:"",size:"small",variant:"text"},{default:e(()=>[t(U,null,{default:e(()=>[s(_(k(Y)),1)]),_:1})]),_:1}),k(o)["topup_request.complete"]?(i(),v(re,{key:1,"requested-license":a,onConfirmed:w},null,8,["requested-license"])):x("",!0)])):a.state=="declined"?(i(),j("div",ce,[t(T,{label:"",color:"error"},{default:e(()=>[s(" Declined ")]),_:1}),t(g,{ripple:!1,icon:"",size:"small",variant:"text"},{default:e(()=>[t(U,null,{default:e(()=>[s(_(k(Z)),1)]),_:1}),t(ee,{title:"Decline Notes",message:a.declinedReason},null,8,["message"])]),_:2},1024)])):a.state=="pending"?(i(),v(T,{key:2,label:"",color:"warning"},{default:e(()=>[s(" Pending ")]),_:1})):x("",!0)]),"item.issuer":e(({item:a})=>[s(_(a.issuer.name),1)]),"item.actor":e(({item:a})=>{var S;return[s(_(((S=a.actor)==null?void 0:S.name)||"-"),1)]}),"item.requester":e(({item:a})=>[s(_(a.requester.name),1)]),"header.state":e(({column:a})=>[b("span",de,[b("div",null,_(a.title),1),t(te,{disabled:d.value,items:l,modelValue:h.value,"onUpdate:modelValue":p[0]||(p[0]=S=>h.value=S)},null,8,["disabled","modelValue"])])]),_:2},1032,["page","items-per-page","items-length","items","loading"])]),_:1})]),_:3}))}}),me=b("div",{class:"text-h5 font-weight-bold"},"TopUp License",-1),$e=L({__name:"RequestedLicense",setup(n){return(q,o)=>(i(),v(K,{fluid:""},{default:e(()=>[t(E,null,{default:e(()=>[t($,null,{default:e(()=>[me]),_:1})]),_:1}),t(E,null,{default:e(()=>[t($,null,{default:e(()=>[t(pe,{"list-requested-license":k(se)},{create:e(({loadRequestedLicense:r})=>[t(ne,{onCreated:r},null,8,["onCreated"])]),_:1},8,["list-requested-license"])]),_:1})]),_:1})]),_:1}))}});export{$e as default};
